var eksell=eksell||{},$=jQuery;var $eksellDoc=$(document),$eksellWin=$(window);function eksellAjaxErrors(jqXHR,exception){var message='';if(jqXHR.status===0){message='Not connect.n Verify Network.';}else if(jqXHR.status==404){message='Requested page not found. [404]';}else if(jqXHR.status==500){message='Internal Server Error [500].';}else if(exception==='parsererror'){message='Requested JSON parse failed.';}else if(exception==='timeout'){message='Time out error.';}else if(exception==='abort'){message='Ajax request aborted.';}else{message='Uncaught Error.n'+jqXHR.responseText;}
console.log('AJAX ERROR:'+message);}
function eksellToggleAttribute($element,attribute,trueVal,falseVal){if(typeof trueVal==='undefined'){trueVal=true;}
if(typeof falseVal==='undefined'){falseVal=false;}
if($element.attr(attribute)!==trueVal){$element.attr(attribute,trueVal);}else{$element.attr(attribute,falseVal);}}
eksell.intervalScroll={init:function(){didScroll=false;$eksellWin.on('scroll load',function(){didScroll=true;});setInterval(function(){if(didScroll){didScroll=false;$eksellWin.trigger('did-interval-scroll');}},250);},}
eksell.toggles={init:function(){eksell.toggles.toggle();eksell.toggles.resizeCheck();eksell.toggles.untoggleOnEscapeKeyPress();},toggle:function(){$('*[data-toggle-target]').on('click',function(e){var $toggle=$(this),targetString=$(this).data('toggle-target'),$target=$(targetString);if($target.is('.active')){$target.trigger('toggle-target-before-active');}else{$target.trigger('toggle-target-before-inactive');}
var timeOutTime=$target.hasClass('cover-modal')?5:0;setTimeout(function(){if($toggle.data('toggle-type')=='slidetoggle'){var duration=$toggle.data('toggle-duration')?$toggle.data('toggle-duration'):250;if($('body').hasClass('has-anim')){$target.slideToggle(duration);}else{$target.toggle();}}else{$target.toggleClass('active');}
$('*[data-toggle-target="'+targetString+'"]').toggleClass('active');eksellToggleAttribute($target,'aria-expanded','true','false');eksellToggleAttribute($toggle,'aria-pressed','true','false');if($toggle.data('toggle-body-class')){$('body').toggleClass($toggle.data('toggle-body-class'));}
if($toggle.data('lock-screen')){eksell.scrollLock.setTo(true);}else if($toggle.data('unlock-screen')){eksell.scrollLock.setTo(false);}else if($toggle.data('toggle-screen-lock')){eksell.scrollLock.setTo();}
if($toggle.data('set-focus')){var $focusElement=$($toggle.data('set-focus'));if($focusElement.length){if($toggle.is('.active')){$focusElement.focus();}else{$focusElement.blur();}}}
$target.trigger('toggled');if($target.is('.active')){$target.trigger('toggle-target-after-active');}else{$target.trigger('toggle-target-after-inactive');}},timeOutTime);return false;});},resizeCheck:function(){if($('*[data-untoggle-above], *[data-untoggle-below], *[data-toggle-above], *[data-toggle-below]').length){$eksellWin.on('resize',function(){var winWidth=$eksellWin.width(),$toggles=$('.toggle');$toggles.each(function(){$toggle=$(this);var unToggleAbove=$toggle.data('untoggle-above'),unToggleBelow=$toggle.data('untoggle-below'),toggleAbove=$toggle.data('toggle-above'),toggleBelow=$toggle.data('toggle-below');if(!unToggleAbove&&!unToggleBelow&&!toggleAbove&&!toggleBelow){return;}
if((((unToggleAbove&&winWidth>unToggleAbove)||(unToggleBelow&&winWidth<unToggleBelow))&&$toggle.hasClass('active'))||(((toggleAbove&&winWidth>toggleAbove)||(toggleBelow&&winWidth<toggleBelow))&&!$toggle.hasClass('active'))){$toggle.trigger('click');}});});}},untoggleOnEscapeKeyPress:function(){$eksellDoc.keyup(function(e){if(e.key==="Escape"){$('*[data-untoggle-on-escape].active').each(function(){if($(this).hasClass('active')){$(this).trigger('click');}});}});},}
eksell.coverModals={init:function(){if($('.cover-modal').length){eksell.coverModals.onToggle();eksell.coverModals.outsideUntoggle();eksell.coverModals.closeOnEscape();eksell.coverModals.hideAndShowModals();}},onToggle:function(){$('.cover-modal').on('toggled',function(){var $modal=$(this),$body=$('body');if($modal.hasClass('active')){$body.addClass('showing-modal');}else{$body.removeClass('showing-modal').addClass('hiding-modal');setTimeout(function(){$body.removeClass('hiding-modal');},500);}});},outsideUntoggle:function(){$eksellDoc.on('click',function(e){var $target=$(e.target),modal='.cover-modal.active';if($target.is(modal)){eksell.coverModals.untoggleModal($target);}});},closeOnEscape:function(){$eksellDoc.keyup(function(e){if(e.key==="Escape"){$('.cover-modal.active').each(function(){eksell.coverModals.untoggleModal($(this));});}});},hideAndShowModals:function(){var $modals=$('.cover-modal');$modals.on('toggle-target-before-inactive',function(e){if(e.target!=this)return;$(this).addClass('show-modal');});$modals.on('toggle-target-after-inactive',function(e){if(e.target!=this)return;var $modal=$(this);setTimeout(function(){$modal.removeClass('show-modal');},250);});},untoggleModal:function($modal){$modalToggle=false;if($modal.data('modal-target-string')){var modalTargetClass=$modal.data('modal-target-string'),$modalToggle=$('*[data-toggle-target="'+modalTargetClass+'"]').first();}
if($modalToggle&&$modalToggle.length){$modalToggle.trigger('click');}else{$modal.removeClass('active');}}}
eksell.stickyHeader={init:function(){var $stickyElement=$('#site-header.stick-me');if($stickyElement.length){if(!$('.header-sticky-adjuster').length){$stickyElement.before('<div class="header-sticky-adjuster"></div>');}
$stickyElement.addClass('is-sticky');eksell.stickyHeader.updateStandIn($stickyElement);$eksellWin.on('resize orientationchange',function(){eksell.stickyHeader.updateStandIn($stickyElement);});}},updateStandIn:function($stickyElement){$('.header-sticky-adjuster').height($stickyElement.outerHeight()).css('margin-bottom',parseInt($stickyElement.css('marginBottom')));}}
eksell.instrinsicRatioVideos={init:function(){eksell.instrinsicRatioVideos.makeFit();$eksellWin.on('resize fit-videos',function(){eksell.instrinsicRatioVideos.makeFit();});},makeFit:function(){var vidSelector="iframe, object, video";$(vidSelector).each(function(){var $video=$(this),$container=$video.parent(),iTargetWidth=$container.width();if($video.hasClass('intrinsic-ignore')||$video.parent().hasClass('intrinsic-ignore')){return true;}
if(!$video.attr('data-origwidth')){$video.attr('data-origwidth',$video.attr('width'));$video.attr('data-origheight',$video.attr('height'));}
var ratio=iTargetWidth/$video.attr('data-origwidth');$video.css('width',iTargetWidth+'px');$video.css('height',($video.attr('data-origheight')*ratio)+'px');});}}
eksell.scrollLock={init:function(){window.scrollLocked=false,window.prevScroll={scrollLeft:$eksellWin.scrollLeft(),scrollTop:$eksellWin.scrollTop()},window.prevLockStyles={},window.lockStyles={'overflow-y':'scroll','position':'fixed','width':'100%'};eksell.scrollLock.saveStyles();},saveStyles:function(){var styleAttr=$('html').attr('style'),styleStrs=[],styleHash={};if(!styleAttr){return;}
styleStrs=styleAttr.split(/;\s/);$.each(styleStrs,function serializeStyleProp(styleString){if(!styleString){return;}
var keyValue=styleString.split(/\s:\s/);if(keyValue.length<2){return;}
styleHash[keyValue[0]]=keyValue[1];});$.extend(prevLockStyles,styleHash);},lock:function(){var appliedLock={};if(scrollLocked){return;}
prevScroll={scrollLeft:$eksellWin.scrollLeft(),scrollTop:$eksellWin.scrollTop()};eksell.scrollLock.saveStyles();$.extend(appliedLock,lockStyles,{'left':-prevScroll.scrollLeft+'px','top':-prevScroll.scrollTop+'px'});$('html').css(appliedLock);$('html').addClass('scroll-locked');$('html').attr('scroll-lock-top',prevScroll.scrollTop);$eksellWin.scrollLeft(0).scrollTop(0);window.scrollLocked=true;},unlock:function(){if(!window.scrollLocked){return;}
$('html').attr('style',$('<x>').css(prevLockStyles).attr('style')||'');$('html').removeClass('scroll-locked');$('html').attr('scroll-lock-top','');$eksellWin.scrollLeft(prevScroll.scrollLeft).scrollTop(prevScroll.scrollTop);window.scrollLocked=false;},setTo:function(on){if(arguments.length){if(on){eksell.scrollLock.lock();}else{eksell.scrollLock.unlock();}}else{if(window.scrollLocked){eksell.scrollLock.unlock();}else{eksell.scrollLock.lock();}}},}
eksell.focusManagement={init:function(){eksell.focusManagement.focusLoops();},focusLoops:function(){$eksellDoc.keydown(function(e){var $focusElement=$(':focus');if(e.keyCode==9){var $destination=false;var $menuModalFocusable=$('.menu-modal').find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').filter(':visible'),$menuModalFirst=$menuModalFocusable.first(),$menuModalLast=$menuModalFocusable.last();if(e.shiftKey){if($focusElement.is('#site-aside .nav-toggle.active')){$destination=$('.menu-modal a:visible:last');}else if($focusElement.is($menuModalFirst)){$destination=$('#site-aside .nav-toggle').is(':visible')?$('#site-aside .nav-toggle'):$menuModalLast;}else if($focusElement.is('.search-modal .search-field')){$destination=$('.search-untoggle');}}
else{if($focusElement.is($menuModalLast)){$destination=$('#site-aside .nav-toggle').is(':visible')?$('#site-aside .nav-toggle'):$menuModalFirst;}else if($focusElement.is('#site-aside .nav-toggle.active')){$destination=$menuModalFirst;}else if($focusElement.is('.search-untoggle')){$destination=$('.search-modal .search-field');}}
if($destination){$destination.focus();return false;}}});}}
eksell.mainMenu={init:function(){eksell.mainMenu.expandLevel();},expandLevel:function(){var $activeMenuItem=$('.main-menu .current-menu-item');if($activeMenuItem.length!==false){$activeMenuItem.parents('li').each(function(){$subMenuToggle=$(this).find('.sub-menu-toggle').first();if($subMenuToggle.length){$subMenuToggle.trigger('click');}})}},}
eksell.loadMore={init:function(){var $pagination=$('#pagination');if($pagination.length){window.eksellIsLoading=false;window.eksellIsLastPage=$('.pagination-wrapper').hasClass('last-page');eksell.loadMore.prepare($pagination);}
$eksellWin.on('reset-posts',function(){$pagination.add($($pagination.data('load-more-target')).find('.article-wrapper')).animate({opacity:0},300,'linear');eksell.loadMore.prepare($pagination,resetPosts=true);});},prepare:function($pagination,resetPosts){if(typeof resetPosts==='undefined'||!resetPosts){resetPosts=false;}
var queryArgs=JSON.parse($pagination.attr('data-query-args'));if(resetPosts){eksell.loadMore.loadPosts($pagination,resetPosts);}
else{if(queryArgs.paged==queryArgs.max_num_pages){$('.pagination-wrapper').addClass('last-page');}
var loadMoreType=$pagination.data('pagination-type')?$pagination.data('pagination-type'):'button';if(loadMoreType=='scroll'){eksell.loadMore.detectScroll($pagination);}else if(loadMoreType=='button'){eksell.loadMore.detectButtonClick($pagination);}}},detectScroll:function($pagination,query_args){$eksellWin.on('did-interval-scroll',function(){if(eksellIsLastPage||eksellIsLoading){return;}
var paginationOffset=$pagination.offset().top,winOffset=$eksellWin.scrollTop()+$eksellWin.outerHeight();if((winOffset>paginationOffset)){eksell.loadMore.loadPosts($pagination,query_args);}});},detectButtonClick:function($pagination,query_args){$('#load-more').on('click',function(){if(eksellIsLoading)return;eksell.loadMore.loadPosts($pagination,query_args);return false;});},loadPosts:function($pagination,resetPosts){if(typeof resetPosts==='undefined'||!resetPosts){resetPosts=false;}
var queryArgs=$pagination.attr('data-query-args'),queryArgsParsed=JSON.parse(queryArgs),$paginationWrapper=$('.pagination-wrapper'),$articleWrapper=$($pagination.data('load-more-target'));eksellIsLoading=true;if(!resetPosts){$paginationWrapper.addClass('loading');}
if(!resetPosts){queryArgsParsed.paged++;}else{queryArgsParsed.paged=1;}
var jsonQueryArgs=JSON.stringify(queryArgsParsed);$.ajax({url:eksell_ajax_load_more.ajaxurl,type:'post',data:{action:'eksell_ajax_load_more',json_data:jsonQueryArgs},success:function(result){var $result=$(result);if(resetPosts){$articleWrapper.find('*:not(.grid-sizer)').remove();}
if(!$result.length){eksellIsLoading=false;$articleWrapper.addClass('no-results');$paginationWrapper.addClass('last-page').removeClass('loading');}
if($result.length){$articleWrapper.removeClass('no-results');$result.find('article').each(function(){$(this).attr('data-post-paged',queryArgsParsed.paged);});$result.imagesLoaded(function(){$articleWrapper.append($result).masonry('appended',$result).masonry();$eksellWin.trigger('ajax-content-loaded');$eksellWin.trigger('did-interval-scroll');eksellIsLoading=false;$paginationWrapper.removeClass('loading');$pagination.attr('data-query-args',jsonQueryArgs);if(resetPosts){setTimeout(function(){$pagination.animate({opacity:1},600,'linear');},400);$('body').removeClass('filtering-posts');}
if(queryArgsParsed.paged==queryArgsParsed.max_num_pages){$paginationWrapper.addClass('last-page');eksellIsLastPage=true;return;}else{$paginationWrapper.removeClass('last-page');eksellIsLastPage=false;}});}},error:function(jqXHR,exception){eksellAjaxErrors(jqXHR,exception);}});},}
eksell.filters={init:function(){$eksellDoc.on('click','.filter-link',function(){if($(this).hasClass('active'))return false;$('body').addClass('filtering-posts');var $link=$(this),termId=$link.data('filter-term-id')?$link.data('filter-term-id'):null,taxonomy=$link.data('filter-taxonomy')?$link.data('filter-taxonomy'):null,postType=$link.data('filter-post-type')?$link.data('filter-post-type'):'';$link.addClass('pre-active');$.ajax({url:eksell_ajax_filters.ajaxurl,type:'post',data:{action:'eksell_ajax_filters',post_type:postType,term_id:termId,taxonomy:taxonomy,},success:function(result){$('#pagination').attr('data-query-args',result);$eksellWin.trigger('reset-posts');$('.filter-link').removeClass('pre-active active');$link.addClass('active');},error:function(jqXHR,exception){eksellAJAXErrors(jqXHR,exception);}});return false;});}}
eksell.elementInView={init:function(){$targets=$('body.has-anim .do-spot');eksell.elementInView.run($targets);$eksellWin.on('ajax-content-loaded',function(){$targets=$('body.has-anim .do-spot');eksell.elementInView.run($targets);});},run:function($targets){if($targets.length){$targets.each(function(){$(this).addClass('will-be-spotted');});eksell.elementInView.handleFocus($targets);$eksellWin.on('load resize orientationchange did-interval-scroll',function(){eksell.elementInView.handleFocus($targets);});}},handleFocus:function($targets){$targets.each(function(){var $this=$(this);if(eksell.elementInView.isVisible($this,checkAbove=true)){$this.addClass('spotted').trigger('spotted');}});},isVisible:function($elem,checkAbove){if(typeof checkAbove==='undefined'){checkAbove=false;}
var winHeight=$eksellWin.height();var docViewTop=$eksellWin.scrollTop(),docViewBottom=docViewTop+winHeight,docViewLimit=docViewBottom;var elemTop=$elem.offset().top;if(checkAbove&&(elemTop<=docViewBottom)){return true;}
return(docViewLimit>=elemTop);}}
eksell.masonry={init:function(){var $wrapper=$('.posts-grid');if($wrapper.length){$wrapper.imagesLoaded(function(){$grid=$wrapper.masonry({columnWidth:'.grid-sizer',itemSelector:'.article-wrapper',percentPosition:true,stagger:0,transitionDuration:0,});$grid.on('layoutComplete',function(){$eksellWin.trigger('scroll');});eksell.masonry.intervalUpdate($grid);$eksellWin.on('ajax-content-loaded',function(){eksell.masonry.intervalUpdate($grid);});});}},intervalUpdate:function($grid){var masonryLayoutInterval=setInterval(function(){$grid.masonry();if(!$('.preview.do-spot:not(.spotted)').length)clearInterval(masonryLayoutInterval);},1000);}}
eksell.dynamicHeights={init:function(){eksell.dynamicHeights.resize();$eksellWin.on('resize orientationchange',function(){eksell.dynamicHeights.resize();});},resize:function(){var $header=$('#site-header'),$footer=$('#site-footer'),$content=$('#site-content')
var headerHeight=$header.outerHeight(),contentHeight=$eksellWin.outerHeight()-headerHeight-parseInt($header.css('marginBottom'))-$footer.outerHeight()-parseInt($footer.css('marginTop'));$content.css('min-height',contentHeight);$('#site-aside .nav-toggle-inner').css('height',headerHeight);$('.search-modal .search-field').css('height',headerHeight);$('<style>.modal-search-form .search-field::-moz-placeholder { line-height: '+headerHeight+'px }</style>').appendTo('head');}}
$eksellDoc.ready(function(){eksell.intervalScroll.init();eksell.toggles.init();eksell.coverModals.init();eksell.elementInView.init();eksell.instrinsicRatioVideos.init();eksell.stickyHeader.init();eksell.scrollLock.init();eksell.mainMenu.init();eksell.focusManagement.init();eksell.loadMore.init();eksell.filters.init();eksell.masonry.init();eksell.dynamicHeights.init();cssVars();});